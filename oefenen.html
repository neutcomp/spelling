<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script>

        function validateForm() {
            // Get the input
            let invoer = $.trim($('#invoer').val().toLowerCase());

            // Get the answer
            let antwoord = $('#antwoord').val();

            // Create some empty variables
            let message = '';
            let className = 'resultaatFout';

            // Check if there is any answer
            if (invoer == "") {
                message = 'Je hebt nog geen antwoord gegeven!';
            } else {
                // Check if the answer is correct
                if (invoer === antwoord || invoer === 'test') { // Debug purpose
                    // Set correct question message and class

                    className = 'resultaatGoed';

                    // Add +1 for the questions we have answerd
                    saveCorrectAmountOfQuestions();

                    // Keep track on how many questions here are beeing answerd correctly
                    saveAmountOfQuestions();

                    // Check if we are done with the test
                    message = checkWhatToShowNext();
                } else {
                    // Set wrong question message and class
                    message = 'Helaas probeer het nog eens';

                    // Keep track on how many questions here are beeing answerd wrongly
                    saveWrongAmountOfQuestions();
                }
            }

            // Set the correct message and class
            $('#result').html(message);
            $('#result').attr('class', className);

            return false;
        }

        function saveAmountOfQuestions() {
            localStorage.setItem('totaalBeantwoord', parseInt(localStorage.getItem('totaalBeantwoord')) + 1);
        }

        function saveCorrectAmountOfQuestions() {
            localStorage.setItem('totaalGoed', parseInt(localStorage.getItem('totaalGoed')) + 1);
        }

        function saveWrongAmountOfQuestions() {
            localStorage.setItem('totaalFout', parseInt(localStorage.getItem('totaalFout')) + 1);
        }

        function checkWhatToShowNext() {
            if (parseInt(localStorage.getItem('totaalBeantwoord')) === parseInt(localStorage.getItem('amountOfQuestions'))) {
                // Hide the buttons to interact with the form
                document.getElementById('controleren').style.display = 'none';
                document.getElementById('volgende').style.display = 'none';

                // Show the button to go to the main page
                document.getElementById('klaar').style.display = 'block';

                return 'Goede gedaan ' + localStorage.getItem('firstname') + ' je bent klaar voor vandaag!';
            } else {
                // Hide the controleren button
                document.getElementById('controleren').style.display = 'none';

                // Show the next button
                document.getElementById('volgende').style.display = 'block';

                return 'Goede gedaan ' + localStorage.getItem('firstname') + ' op naar de volgende vraag!';
            }
        }

        function onInit() {
            // Set default values
            setDefaultValues();

            // Set the audio file
            setAudioInformation();
        }

        function setDefaultValues() {
            if (localStorage.getItem('totaalGoed') === null) {
                localStorage.setItem('totaalGoed', 0);
            }

            if (localStorage.getItem('totaalFout') === null) {
                localStorage.setItem('totaalFout', 0);
            }

            if (localStorage.getItem('totaalBeantwoord') === null) {
                localStorage.setItem('totaalBeantwoord', 0);
            }

            // Hide by default the next button
            document.getElementById('volgende').style.display = 'none';
            document.getElementById('klaar').style.display = 'none';
        }

        function setAudioInformation() {
            // Data allready loaded so just pick the answer from the stored array
            if (localStorage.getItem('questionsToAsk')) {
                let questionsArray = localStorage.getItem('questionsToAsk').split(',');
                let antwoord = questionsArray[localStorage.getItem('totaalBeantwoord')];
                console.log('het antwoord: ' + antwoord);
                fillAnswer(antwoord);
                return false;
            }

            // Create an array with all audio files
            const questionsPlank = [
                'schalks', 'zelfs', 'zwerft', 'sponst', 'snurkt', 'stroomt', 'zwermt', 'tjilpt', 'stompt', 'stampt', 'plonst', 'plenst', 'plaats', 'kwarts', 'krimpt', 'kletst', 'grenst', 'fronst', 'strikt', 'strijkt', 'strekt', 'streept', 'straks', 'straft', 'straalt', 'sprits', 'sprint', 'spreekt', 'splits', 'terts', 'scherps', 'pumps', 'nerts', 'korps', 'kilts', 'films', 'erts', 'balts', 'arts', 'struik', 'strop', 'stroop', 'stroom', 'strook', 'stroef', 'strip', 'strik', 'strijk', 'striem', 'strek', 'streep', 'streek', 'strak', 'straf', 'straal', 'spreuk', 'spreek', 'sprak', 'spraak'
            ]

            const questionsZing = [
                'waardering',
                'veering',
                'bewondering'
            ]

            const questionsHak = [
                'boter',
                'water',
                'haring'
            ]

            let cat = localStorage.getItem('categorie');

            // Calculate how many questions per category
            let amountOfQuestions = localStorage.getItem('amountOfQuestions');
            let categories = cat.split(',');
            let amountOfCategories = categories.length;

            // console.log('What categories: ' + categories);
            // console.log('Amount of Questions: ' + amountOfQuestions);
            // console.log('Amount of Categories: ' + amountOfCategories);

            let amountPerCat = parseInt(amountOfQuestions / amountOfCategories);
            let restValue = amountOfQuestions % amountOfCategories;

            // console.log('Amount per Category: ' + amountPerCat);
            // console.log('Amount of rest value: ' + restValue);

            let questions = [];
            for (let x = 0; x < categories.length; x++) {
                let questionArrayName = getArrayName(categories[x]);

                for (let x = 0; x < amountPerCat; x++) {
                    // Pick a random question
                    questions.push(getRandomCategorieQuestion(eval(questionArrayName)));
                }
            };

            console.log('Questions to ask: ' + questions);

            if (restValue > 0) {
                // Pick a random categorie
                const randomCategorie = categories[Math.floor(Math.random() * categories.length)];
                // console.log('random categorie =>', randomCategorie);

                let questionArrayName = getArrayName(randomCategorie);

                for (let x = 0; x < restValue; x++) {
                    // Pick a random question
                    questions.push(getRandomCategorieQuestion(eval(questionArrayName)));
                }
            }

            // console.log('Questions to ask: ' + questions);
            localStorage.setItem('questionsToAsk', questions);

            // Set the audio file and answer in the form
            let antwoord = questions[localStorage.getItem('totaalBeantwoord')];

            fillAnswer(antwoord);
        }

        function fillAnswer(antwoord) {
            // console.log('antwoord' + antwoord);
            document.getElementById('antwoord').value = antwoord;
            document.getElementById('audioBestand').src = './Audio/' + antwoord + '.m4a';
        }

        function getArrayName(categorieName) {
            switch (categorieName) {
                case 'zing':
                    return 'questionsZing';
                    break;
                case 'plank':
                    return 'questionsPlank';
                    break;
                case 'hak':
                    return 'questionsHak';
                    break;
                default:
                    break;
            }
        }

        function getRandomCategorieQuestion(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }
    </script>
</head>

<body onload="onInit();">
    <div class="main">
        <div class="intro">
            <h1><a href="index.html">Spelling oefenen</a></h1>
            <div class="intro">Luister maar het fragment</div>
        </div>

        <div class="sectie">
            <iframe src="silence.mp3" allow="autoplay" id="audio" style="display:none"></iframe>
            <audio id="audioBestand" type="audio/x-m4a" controls autoplay="autoplay">
                <code> Your browser doesn't support audio tags</code>
            </audio>
        </div>

        <div class="sectie">
            <form name="myForm" action="oefenen.html" onsubmit="return validateForm()" method="post">
                <input type="hidden" id="antwoord">
                <label>Type hier je antwoord</label>
                <div><input class="input" type="text" id="invoer"></div>
                <div><button class="button" type="submit" id="controleren">controleren</button></div>
            </form>

            <div><button class="button hidden" onclick="location.reload();" id="volgende">volgende</button></div>
            <div><button class="button hidden" onclick="location.href='index.html';" id="klaar">klaar!</button></div>
        </div>

        <div class="result" id="result"></div>
    </div>
</body>

</html>